@model PagedList.IPagedList<BTL.Models.TaiKhoan>
@using PagedList.Mvc
@{
    ViewBag.Title = "AccountManager";
}

@section loadScript {
    <link rel="stylesheet" href="~/wwwroot/styles/admin/account-manager.css">
    <link rel="stylesheet" href="~/wwwroot/styles/admin/draw-detail-user.css">
    <script src="~/wwwroot/js/admin/account/index.js"></script>
}

@section draw {
    <div id="draw">
        <div id="draw_layer" onclick="hiddenDraw()"></div>
        <div id="draw_content">
            <h1>Thêm tài khoản</h1>
            @using (Html.BeginForm("Create", "AccountManager", FormMethod.Post, new { enctype = "multipart/form-data", @class = "draw_form", @id = "draw_form" }))
            {
                @Html.AntiForgeryToken()
                    <div class="part1">
                        <div>
                            <div class="input_item">
                                <label for="ten_tai_khoan">Tên tài khoản: </label>
                                <input placeholder="Tên tài khoản" type="text" id="ten_tai_khoan" name="hoTen" />
                            </div>
                            <div class="input_item">
                                <label for="ten_dang_nhap">Tên đăng nhập: </label>
                                <input placeholder="Tên đăng nhập" type="text" id="ten_dang_nhap" name="tenDangNhap" />
                            </div>
                            <div class="input_item">
                                <label for="mat_khau_nguoi_dung">Mật khẩu: </label>
                                <input placeholder="Mật khẩu" type="text" id="mat_khau_nguoi_dung" name="password" />
                            </div>
                        </div>
                        <div class="input_file">
                            <label for="avatar_nguoi_dung">
                                <img id="img_avatar_nguoi_dung" src="~/wwwroot/asset/images/default-avatar.jpg" width="120px" height="120px" />
                            </label>
                            <input type="file" id="avatar_nguoi_dung" onchange="handleAvatar(event)" name="ImageFile" />
                        </div>
                    </div>
                    <div class="part2">
                        <div class="input_item">
                            <label for="email_nguoi_dung">Email: </label>
                            <input placeholder="Email" type="email" id="email_nguoi_dung" name="email" />
                        </div>
                        <div class="input_item">
                            <label for="sdt_nguoi_dung">Số điện thoại: </label>
                            <input placeholder="Số điện thoại" type="number" id="sdt_nguoi_dung" name="sdt" />
                        </div>
                    </div>
                    <div class="part2">
                        <div class="input_item">
                            <label for="dia_chi_nguoi_dung">Địa chỉ: </label>
                            <input placeholder="Địa chỉ" type="text" id="dia_chi_nguoi_dung" name="diaChi">
                        </div>
                        <div class="input_item">
                            <label for="loai_tai_khoan">Loại tài khoản</label>
                            <select id="loai_tai_khoan" name="maLoaiTK">
                                @foreach (var item in ViewBag.Roles)
                                {
                                    <option value="@item.maLoaiTK">@item.level</option>
                                }
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="button_submit">Lưu thay đổi</button>
            }
        </div>
    </div>
}

<div class="account_management">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px">
        <h1 style="margin: 0">Danh mục tài khoản</h1>
        @using (Html.BeginForm())
        {
            @Html.TextBox("SearchString", ViewBag.CurrentFilter as string, new { @placeholder = "Tìm kiếm theo tên/account", @style = "padding: 6px 15px; min-height: 25px; min-width: 250px" })
            <input type="submit" value="Tìm kiếm" style="min-height: 41px; background-color: #fff; border: 0.5px solid; cursor: pointer" />
        }
        <span class="icon" onclick="showDraw()" title="Thêm tài khoản" style="margin-left: 30px; cursor: pointer">
            <i class="fas fa-plus-square" style="font-size: 30px"></i>
        </span>
    </div>
    <table>
        <tr>
            <th>STT</th>
            <th>Tên đăng nhập</th>
            <th>Mật khẩu</th>
            <th>
                Tên tài khoản:
                @Html.ActionLink(
                    "Sắp xếp",
                    "AccountManager",
                    new
                            {
                        sortOrder = ViewBag.SortWithName == "" ?
                            "name_desc" :
                            ViewBag.SortWithName == "name_desc" ?
                                "name"
                                : ""
                        ,
                                currentFilter = ViewBag.CurrentFilter
                    })
                @(ViewBag.SortWithName == "" ? "" : ViewBag.SortWithName == "name_desc" ? ": Z -> A" : ": A -> Z")
            </th>
            <th>Email</th>
            <th>Loại tài khoản</th>
            <th></th>
        </tr>
        @{
            var index = 0;
        }
        @foreach (var item in Model)
        {
            index++;
            <tr>
                <td>@index</td>
                <td>@item.tenDangNhap</td>
                <td>@item.password</td>
                <td>@item.hoTen</td>
                <td>@item.email</td>
                <td>@(item.loaiTaiKhoan.level == "user" ? "người dùng" : "quản trị")</td>
                <td class="action">
                    <span class="icon">
                        <a href="@Url.Action("Edit", "AccountManager", new { id = item.maTaiKhoan })">
                            <i class="fas fa-edit"></i>
                        </a>
                    </span>
                    <div class="delele_account">
                        <div class="btn_delete_account" id="btn_delete_account_@item.maTaiKhoan">
                            <p>Bạn có chắc muốn xóa danh mục này?</p>
                            @using (Html.BeginForm("DeleteConfirmed", "AccountManager", FormMethod.Post, new { @style = "display: inline-block" }))
                            {
                                @Html.AntiForgeryToken()
                                <input name="id" value="@item.maTaiKhoan" style="display: none" />
                                <input type="submit" value="Xóa" class="btn btn-default" />
                            }
                            |<span onclick="showPopupDelete(@item.maTaiKhoan)">Hủy</span>
                        </div>
                        <span class="icon" onclick="showPopupDelete(@item.maTaiKhoan, true)">
                            <i class="fas fa-trash-alt" title="Xóa tài khoản"></i>
                        </span>
                    </div>
                </td>
            </tr>
        }
    </table>
    <div>
        Trang @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) / @Model.PageCount
        @Html.PagedListPager(Model, page => Url.Action("AccountManager", new { page, sortOrder = ViewBag.CurrentSort, currentFilter = ViewBag.CurrentFilter }))
    </div>
</div>
